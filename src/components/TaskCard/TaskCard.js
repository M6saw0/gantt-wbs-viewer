import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useDataStore } from '../../store/dataStore';
import { useUiStore } from '../../store/uiStore';
import { formatDate } from '../../utils/date';
import './TaskCard.css';
export const TaskCard = () => {
    const { showTaskCard, taskCardId, closeTaskCard } = useUiStore();
    const getTaskById = useDataStore(state => state.getTaskById);
    const tasks = useDataStore(state => state.tasks);
    if (!showTaskCard || !taskCardId)
        return null;
    const task = getTaskById(taskCardId);
    if (!task)
        return null;
    // Resolve predecessor names
    const predecessors = task.predecessorIds.map(id => {
        const pred = tasks.find(t => t.taskId === id);
        return pred ? { id, name: pred.name } : { id, name: `ID: ${id}` };
    });
    return (_jsx("div", { className: "task-card-overlay", onClick: closeTaskCard, children: _jsxs("div", { className: "task-card", onClick: e => e.stopPropagation(), children: [_jsxs("div", { className: "task-card-header", children: [_jsxs("h2", { className: "task-card-title", children: [task.isCritical && _jsx("span", { className: "task-card-critical-badge", children: "\u30AF\u30EA\u30C6\u30A3\u30AB\u30EB" }), task.name] }), _jsx("button", { className: "task-card-close", onClick: closeTaskCard, children: "\u2715" })] }), _jsxs("div", { className: "task-card-body", children: [_jsxs("div", { className: "task-card-section", children: [_jsx("h3", { children: "\u57FA\u672C\u60C5\u5831" }), _jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "ID:" }), _jsx("span", { children: task.taskId })] }), _jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u30BF\u30B9\u30AF\u540D:" }), _jsx("span", { children: task.name })] }), task.class1 && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u5206\u985E1:" }), _jsx("span", { children: task.class1 })] })), task.class2 && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u5206\u985E2:" }), _jsx("span", { children: task.class2 })] })), task.class3 && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u5206\u985E3:" }), _jsx("span", { children: task.class3 })] }))] }), _jsxs("div", { className: "task-card-section", children: [_jsx("h3", { children: "\u65E5\u7A0B" }), task.start && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u958B\u59CB\u65E5:" }), _jsx("span", { children: formatDate(task.start) })] })), task.finish && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u7D42\u4E86\u65E5:" }), _jsx("span", { children: formatDate(task.finish) })] })), task.effortDays !== undefined && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u5DE5\u6570\uFF08\u4EBA\u65E5\uFF09:" }), _jsx("span", { children: task.effortDays })] }))] }), predecessors.length > 0 && (_jsxs("div", { className: "task-card-section", children: [_jsx("h3", { children: "\u524D\u5DE5\u7A0B" }), _jsx("ul", { className: "task-card-list", children: predecessors.map(pred => (_jsxs("li", { children: [pred.name, " (ID: ", pred.id, ")"] }, pred.id))) })] })), _jsxs("div", { className: "task-card-section", children: [_jsx("h3", { children: "\u72B6\u614B" }), task.assignedTo && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u62C5\u5F53:" }), _jsx("span", { children: task.assignedTo })] })), task.progress !== undefined && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u9032\u6357:" }), _jsxs("div", { className: "task-card-progress", children: [_jsx("div", { className: "task-card-progress-bar", children: _jsx("div", { className: "task-card-progress-fill", style: { width: `${task.progress}%` } }) }), _jsxs("span", { className: "task-card-progress-text", children: [task.progress, "%"] })] })] }))] }), (task.detail || task.note) && (_jsxs("div", { className: "task-card-section", children: [_jsx("h3", { children: "\u8AAC\u660E" }), task.detail && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u8A73\u7D30:" }), _jsx("p", { className: "task-card-text", children: task.detail })] })), task.note && (_jsxs("div", { className: "task-card-field", children: [_jsx("label", { children: "\u5099\u8003:" }), _jsx("p", { className: "task-card-text", children: task.note })] }))] }))] })] }) }));
};
